# 13 Vue API 与生命周期

## 适用范围

- 处理 uni-app 页面生命周期、常用实例 API、运行时行为差异时使用。

## 规则

- 页面初始化优先在 `onLoad` 处理入参与首屏数据准备，避免把重逻辑堆到模板渲染阶段。
- 页面可见性刷新放 `onShow`，资源释放放 `onUnload`，避免生命周期职责混用。
- 高频事件（如滚动）处理必须轻量化，重计算或频繁请求需做节流/防抖。
- 页面级副作用（定时器、监听器）必须在离开页面时清理，防止内存泄漏与重复触发。
- 实例 API 调用前先确认运行平台能力，跨端差异通过适配层收敛。
- Vue2 风格页面中方法与生命周期回调保持普通函数写法，避免 `this` 指向丢失。
- 数据更新遵循响应式原则，避免直接操作 DOM 作为主更新手段。
- Vue3 组合式生命周期钩子与页面生命周期可并存，调用顺序需通过日志或测试明确验证。

## 示例

- `onLoad` 中读取路由参数并发起初始化请求，`onShow` 仅做轻量刷新。
- 页面离开前清除 `setInterval` 与事件订阅，防止返回页面后重复执行。
- 将端能力调用封装到统一方法，再在生命周期中按需调用。
- 关键生命周期链路记录埋点，验证 `onLoad -> onShow -> onUnload` 与组合式钩子执行顺序。

## 反例

- 每次 `onShow` 都执行完整初始化与重请求，导致回退卡顿。
- 在页面销毁后未清理监听与定时器，触发幽灵回调。
- 生命周期或方法中大量使用箭头函数导致 `this` 指向异常（Vue2 风格页面）。
- 依赖手动 DOM 操作驱动核心状态，造成跨端行为不可控。
- 未验证组合式钩子与页面生命周期交互，导致清理时机错误。

## 检查项

- 生命周期职责是否清晰（`onLoad/onShow/onUnload`）。
- 页面副作用是否可回收且无重复绑定。
- 高频回调是否已做性能控制。
- 实例 API 是否经过平台能力判断与适配层封装。
- Vue2 风格页面 `this` 使用是否稳定。
- 生命周期交互顺序是否有可复现验证结果。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-api.html
