# 16 Vue3 基础与迁移要点

## 适用范围

- 在 uni-app Vue3 项目中处理语法升级、迁移兼容、模板行为差异时使用。

## 规则

- uni-app Vue3 入口遵循 Vue3 应用初始化方式，避免沿用旧版 Vue2 全局 API 写法。
- `main.js` 中 `createApp` 导出名与 `createSSRApp` 导入名保持规范，禁止随意改名导致启动链路失效。
- H5 环境变量统一使用 `VITE_` 前缀并通过 `import.meta.env` 读取；非 H5 端按 uni-app 约定通过 `process.env.*` 读取。
- 全局能力注入统一使用 `app.config.globalProperties` 与 `app.use(...)`，禁止继续挂载 `Vue.prototype`。
- Vue3 项目根目录必须维护 `index.html`（含 `#app` 挂载点和模块化入口脚本）。
- 模块规范统一为 ES Module，迁移时必须替换 `require/module.exports` 写法。
- 新组件优先使用 `setup` / `script setup`，并显式声明 `props/emits`。
- 多个 `v-model` 绑定使用 Vue3 约定（`modelValue` + `update:modelValue` 或参数化写法）。
- `v-bind` 对象合并顺序以书写顺序为准，冲突场景必须显式声明优先级。
- `v-if` 与 `v-for` 同节点时按 Vue3 规则处理，复杂场景优先拆分模板节点提升可读性。
- `key` 使用策略遵循 Vue3 约束：唯一、稳定、语义化，不依赖索引与随机值。
- 生命周期迁移遵循命名变更：`beforeDestroy -> beforeUnmount`、`destroyed -> unmounted`。
- 不依赖 `created` 与 `onLoad` 的执行先后，初始化逻辑按职责拆分到页面生命周期与组件生命周期。
- 事件契约必须显式声明 `emits`；迁移后不再依赖 `.native` 修饰符。
- 插槽写法统一迁移到 `v-slot`，禁止继续使用 `slot="xxx"`。
- 过滤器写法统一迁移为方法或计算属性，Vue3 不再支持 filters。
- uni API Promise 化语义按 Vue3 标准处理：成功走 `then`，失败走 `catch`；旧逻辑需统一改造。
- 组合式页面生命周期仅在 `setup`/`script setup` 中注册，应用级生命周期只在 `App.vue` 监听。
- 页面参数优先通过 `props` 接收，避免路由参数读取方式在多端不一致。
- Vue3 实例上下文字段由 `$mp` 迁移为 `$scope`。
- 性能优化按需使用 `v-memo`，仅针对大列表和高频更新热点，不做全局滥用。
- 历史 Vue2 项目迁移时，兼容构建开关仅作为过渡手段，最终以原生 Vue3 写法收敛。

## 示例

- 组件显式声明 `emits`，避免事件透传不清晰。
- 表单组件采用 `v-model` 新语义，与 `update:*` 事件对齐。
- 列表渲染使用业务主键作为 `key`，并拆分条件渲染节点。
- 高频列表局部使用 `v-memo`，并通过性能对比验证收益。
- 小程序端事件延迟场景，在触发元素上增加 `data-eventsync="true"` 兜底。
- 页面跳转参数在目标页用 `defineProps`/`props` 直接接收，减少 `onLoad` 参数解析分叉。
- 需要兼容旧 Promise 返回格式时，在 `main.js` 统一通过 `uni.addInterceptor` 做过渡转换。

## 反例

- 在 Vue3 项目沿用 Vue2 组件选项习惯，导致事件与双绑行为不一致。
- `v-bind="obj"` 与字面量属性混写但未考虑顺序，出现覆盖误判。
- 将 `v-if` 与 `v-for` 长期堆在同节点，模板复杂且难维护。
- 为“看起来更快”在全页面滥用 `v-memo`，增加维护成本且收益不明显。
- 在 Vue3 项目继续使用 `Vue.prototype`、`require/module.exports`，导致构建与运行链路异常。
- 在小程序组件上继续依赖 `.native` 或 `slot="xxx"` 老写法，导致事件与插槽行为异常。
- 迁移后仍按 Vue2 方式处理 uni API Promise 返回值，错误分支漏处理。

## 检查项

- 组件是否遵循 Vue3 的 `props/emits/v-model` 语义。
- 模板中 `v-bind` 合并顺序、`v-if/v-for` 组合是否可读且行为明确。
- `key` 是否稳定且具业务语义。
- 性能优化手段是否按需启用并有验证依据。
- 迁移兼容配置是否有下线计划与时间点。
- 启动入口、模块规范、环境变量读取是否全部收敛到 Vue3 约定。
- 生命周期命名与执行时机假设是否已完成迁移回归。
- 事件、插槽、过滤器、Promise 调用方式是否完成语义替换并通过多端验证。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/migration-to-vue3.html
