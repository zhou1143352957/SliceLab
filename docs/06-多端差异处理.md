# 06 多端差异处理

## 适用范围

- 同功能需兼容 H5、App、小程序等多端时使用。

## 规则

- 多端实现优先采用“统一 `uni.*` API + 条件编译”组合。
- 同路径同时存在 `.vue` 与 `.nvue` 时：非 App 端优先 `.vue`，App 端优先 `.nvue`。
- nvue 主要用于 App 端原生渲染强化场景；如果目标不含 App，默认不引入 nvue。
- 平台差异统一收敛在适配层，不把分支散落到页面。
- 使用条件编译控制端能力：`#ifdef` / `#ifndef`。
- 条件编译不仅用于 `js/vue`，也可用于 `nvue/css/pages.json/manifest.json/uts`，配置侧差异优先在配置文件收敛。
- 仅当编译到目标端时条件代码才会生效，未命中的代码在构建产物中会被移除。
- 对不可用能力提供降级方案与用户提示。
- 端特定逻辑写注释说明原因与影响范围。
- 涉及 `app-nvue` 页面时，布局优先 `flex`，减少跨端样式偏差。
- nvue 深度场景优先级：区域长列表/瀑布流、复杂下拉刷新、原生组件层级覆盖（`map/video/live-pusher`）与高频左右滑动列表。
- 端差异静态资源放 `static/<platform>/` 子目录（如 `web`、`app`、`mp-weixin`），避免资源互相污染。
- `onPageScroll` 在 `nvue` 暂不支持，滚动交互能力需按端降级设计。
- `uni-app x` 场景下 `dialogPage` 不影响页面栈和标准路由路径，按普通页面路径规则维护即可。
- 条件编译宏优先使用平台专属标识（如 `APP-PLUS`、`APP-ANDROID`、`APP-IOS`、`H5`、`MP-WEIXIN`），避免使用宽泛宏导致误命中。
- web 窗体扩展能力（`leftWindow/rightWindow/topWindow`）仅在 web 端生效，跨端分栏优先使用页面内组件化布局。
- uni-app SSR 仅面向 H5 web 场景；小程序/App 端仍按客户端渲染链路实现。
- `npm` 模块需评估跨端兼容性：大量仅依赖 `DOM/window` 的包通常只适配 H5。
- 优先使用 uni 插件市场里标注“多端可用”的库，减少自行兼容成本。
- 被 `import` 的 `json` 内条件编译会按目标平台生效，不同端读取结果可能不同。
- 支付宝小程序组件中 `image` 标签不支持相对路径，静态资源需使用绝对路径或脚本导入绑定。
- 小程序原生组件配置统一写在 `pages.json -> globalStyle -> usingComponents`，并按平台键拆分（如 `wxcomponents/mycomponents/swancomponents/ttcomponents/kscomponents/jdcomponents/xhscomponents`）。
- 小程序脚本扩展按平台选型：微信使用 `wxs`，支付宝/百度使用 `sjs`，QQ/字节按各平台 `filter` 语法实现，不跨平台复用同一实现。
- 小程序平台专属 API 必须加条件编译（如 `#ifdef MP-WEIXIN`、`#ifdef MP-ALIPAY`），并给非目标端提供降级路径。
- 同时接入多个小程序平台组件时，组件别名与路径按平台独立维护，避免标签名冲突与路径串用。
- 小程序插件需在 `manifest.json` 对应平台节点声明：微信/支付宝用 `plugins`，百度用 `dynamicLib`，并按插件文档配置 `version/provider`。
- 微信插件组件在 `pages.json -> page.style.mp-weixin.usingComponents` 中通过 `plugin://<插件别名>/<组件名>` 引入，不直接写本地路径。
- `export` 字段从 `HBuilderX 3.2.13+` 支持（微信/支付宝），用于向插件导出宿主侧能力；低版本环境不依赖该能力。
- 小程序分包插件场景中，微信支持在 `subPackages` 声明 `plugins`；支付宝/百度不支持在分包内引入插件。
- 同一插件不能被多个分包同时引用；分包外页面不能直接跳入分包内插件页，需先进入该分包普通页再跳转。
- 小程序插件开发工程统一使用 `plugin/` 目录，入口配置落在 `plugin/plugin.json`（包含 `main/publicComponents/pages`）。
- 微信插件基础库要求 `1.9.6+`；若插件包含页面能力，基础库要求 `2.1.0+`。
- 插件开发的 `plugin.json` 允许按平台分段（如 `mp-weixin/mp-alipay`），平台差异优先在 `plugin.json` 用条件编译收敛。
- CLI 调试/构建插件必须显式传 `--plugin <插件目录名>`，避免按普通小程序链路编译。
- 插件开发场景可使用自定义条件编译宏（`MP-WX-PLUGIN`、`MP-ALIPAY-PLUGIN`）隔离宿主代码与插件代码。
- 插件页面/组件存在摇树优化被裁剪风险，发布前需在 `main.js` 直接导入关键页面与组件保留产物。
- 微信小程序分包异步化需在 `manifest.json -> mp-weixin` 启用 `lazyCodeLoading: "requiredComponents"`，并要求基础库 `2.11.2+`。
- 分包异步化页面中的跨分包组件需配置 `componentPlaceholder`，并提供体积更小的占位组件避免首屏阻塞。
- 分包异步化当前不支持 `vue3`，相关项目默认按 `vue2` 能力边界设计并标注迁移风险。
- 分包异步化下跨分包 JS 禁止 `import`（含静态与动态）；统一使用 `require('../sub-package/...')` 运行时加载。
- App 原生插件（Android/iOS）与鸿蒙扩展是两条不同路线：前者走 `native-plugin`，后者优先走 UTS/鸿蒙专题能力。
- 鸿蒙能力接入优先搜索插件市场 `鸿蒙+能力`，优先复用已有 UTS API 插件。
- uni-app 编译到 Harmony Next 的基础门槛为 `HBuilderX 4.27+`。
- 鸿蒙 App 当前仅支持 `vue3` 项目编译；`vue2` 需先迁移。
- 鸿蒙运行调试从 `HBuilderX 4.24+` 开始支持；鸿蒙端不支持 `plus`，但支持 `nvue`（按 web 渲染兼容）。
- 鸿蒙运行与发行依赖 DevEco Studio 工具链，模拟器需在 DevEco Studio 中启动。
- 鸿蒙扩展以 UTS 插件为主；App 原生语言插件路线已停止维护。
- 嵌入鸿蒙原生组件能力从 `HBuilderX 4.62+` 支持，且通过 UTS 插件注册到 WebView 侧使用。
- 鸿蒙 map/getLocation/openLocation/chooseLocation 当前依赖地图厂商能力，按文档链路默认对接腾讯地图。
- 鸿蒙应用外部唤起分两类：Deep Linking（自定义 Scheme）与 App Linking（https 域名认证）。
- 鸿蒙应用外部唤起建议统一走 `uni_modules/uts-openSchema`，业务侧只调用封装后的 `canOpenURL/openSchema`。
- `harmony-configs/entry/src/main/module.json5` 根节点 `querySchemes` 仅用于 Deep Linking 的 `canOpenURL` 白名单，最多 50 项。
- Deep Linking 拉起前先执行 `canOpenURL`，对失败分支做提示与降级，避免直接调用失败。
- App Linking 场景不使用 `canOpenURL`，直接 `openSchema(https://...)`。
- 鸿蒙元服务拉起能力通过 UTS 插件扩展（如 AbilityKit）封装后暴露，不在页面层直接调用原生 API。
- 鸿蒙支付接入优先走 `uni-pay` 华为支付链路，避免页面层直接拼接平台 SDK 参数。
- `uni-pay/config.js` 的 `huawei.mp.clientType` 固定为 `mp-harmony`，`huawei.app.clientType` 固定为 `app-harmony`，禁止改写。
- `mchPrivateKey` 仅保留在服务端配置；`platformPublicKey` 使用华为支付证书正文内容，不混用证书头尾文本。
- 支付回调 `notifyUrl` 统一配置为项目对应的 uniCloud 地址，并与 HBuilderX 登录账号保持一致。
- 鸿蒙应用侧发起支付前，需在 `manifest.json` 的鸿蒙 `uni-payment` 中启用华为支付能力。
- `Native.js`（`plus.android.*` / `plus.ios.*`）在 uni-app 中仅用于遗留能力兜底，不作为新功能首选方案。
- `Native.js` 不支持 UI/webview 相关能力，涉及界面层改造优先使用原生插件或 UTS 插件路线。
- `renderjs` 仅用于 `app-vue` 与 H5，不支持 `nvue` 与小程序端；小程序同类诉求使用 `wxs/sjs` 路线。
- `renderjs` 仅支持内联方式声明，不使用 `src` 外链脚本。
- `blurEffect` 仅支持 `app-vue`；`nvue` 与小程序/H5 不生效。
- `blurEffect` 与 `backgroundColor` 需使用纯色值，不使用 `rgba` 与 `gradient` 组合。
- App 端默认 User Agent 基于系统 WebView，并附加 `Html5Plus/1.0` 与 `uni-app` 字段。
- 自定义 User Agent 通过 `manifest.json -> app-plus.useragent` 配置；`concatenate=true` 表示追加，`false` 表示替换默认 UA。
- 非 H5 端不提供浏览器全局对象（如 `window/document/navigator`），跨端代码禁止直接依赖这些对象。
- CORS 约束主要发生在 H5 浏览器环境；普通小程序/App 的 `uni.request` 默认不走浏览器同源策略。
- 异步 API 错误回调统一返回 `UniError`，避免仅返回字符串或平台原始错误对象。
- `UniError` 至少包含 `errSubject/errCode/errMsg`，可选 `data/cause` 用于补充成功数据与源错误链路。
- 新增错误码建议遵循 7 位规则：前 2 位一级类目、3-4 位二级类目、5-7 位具体错误类型。
- 平台专有错误码尾段建议统一：跨端 `6xx`、Android `7xx`、iOS `8xx`、Web `9xx`、Harmony `5xx`。
- 三方或下游错误统一封装为 `SourceError`，存在多个源错误时封装为 `UniAggregateError` 再挂到 `cause`。
- `errSubject` 命名统一使用模块维度：内置 API 使用 `uni-API名`，插件使用 `插件id-API名`，避免重名冲突。
- 在 UTS 插件与 uvue 页面中抛错统一使用 `new UniError(...)`，不直接 `throw string/object`。
- uni-app JS 以 ECMAScript 为基础并扩展 `uni` API；端能力调用优先走 `uni` 与适配层。
- App 端 JS 在独立引擎执行，页面渲染区分 `vue`（webview）与 `nvue`（原生视图）两种机制。
- 样式能力按端区分：`vue` 页面支持常规 web CSS；`nvue/uvue` 样式能力受原生渲染约束。
- 在 `template/style` 写条件编译时，注释语法必须使用 HTML/CSS 注释，不使用 JS 注释写法。
- 静态资源条件编译通过目录约定实现：`/static/<平台目录>/...`；`static` 内文件本身不支持 `#ifdef`。
- `js` 运行时平台判断（如 `uni.getSystemInfoSync().platform`）只用于运行逻辑分支，不替代编译期裁剪。
- `plus.*` 与 `plus.os.name` 仅在 App-Plus 可用，统一放在 `#ifdef APP-PLUS` 内调用。
- `uni-app` 中不需要等待 `plusready`，且不应使用 `document.addEventListener('plusready', ...)`。
- `uni-app` 中监听原生事件需使用 `plus.globalEvent.addEventListener`，不使用 `document.addEventListener`。
- `Native.js` 调用必须按端拆分：Android 走 `APP-ANDROID`，iOS 走 `APP-IOS`，禁止混写同一路径调用。
- `renderjs` 不能直接访问逻辑层数据，需通过 `props` 监听与 `this.$ownerInstance.callMethod` 通信。
- `renderjs` 调用逻辑层方法时，目标方法需定义在页面 `methods`（不走 `setup` 导出）。
- 自建 `uni_modules` 插件命名禁止 `uni-` 前缀，避免与官方生态命名冲突。
- 鸿蒙 UTS 扩展需在插件 `package.json` 的 `uni_modules.uni-ext-api` 中开启 `app.arkts=true`。
- 鸿蒙第三方库（ohpm）仅可在 `/uni_modules/*/utssdk/app-harmony/*.uts` 内 `import`，不可直接在页面 `pages` 中使用。
- 页面侧调用鸿蒙第三方库时，需先引入 UTS 插件接口，再由插件内部转调 ohpm。
- 鸿蒙原生组件定义仅支持在 `ets` 文件中完成，并需在 `app-harmony/index.uts` 中显式导入生效。
- `defineNativeEmbed` 的组件 `tag` 仅支持小写命名，暂不支持驼峰。
- 页面通过 `embed` 组件调用鸿蒙原生组件；`options` 更新需重新赋值对象触发更新。
- `embed` 上注册的事件会转发到原生层，事件名需与原生定义保持一致。
- 鸿蒙 URL Scheme 配置在 `harmony-configs/entry/src/main/module.json5`，通过 `module.abilities[0].skills` 追加，不覆盖既有 `skills[0]`。
- Deep Linking 的 `actions` 固定为 `ohos.want.action.viewData`；`uris.scheme` 与 `uris.host` 必填，`host` 不可为空且不使用 `*`。
- App Linking 需同时满足：AGC 开通并发布应用链接、域名部署 `/.well-known/applinking.json`、`module.json5` 中 `entities/actions/domainVerify` 固定配置。
- App Linking 下 `uris.scheme` 固定 `https`，`host` 需与 AGC 后台及 `applinking.json` 保持一致。
- 鸿蒙 map key 配置在 `manifest.json -> app-plus.distribute.sdkConfigs.maps.qqmap.key`；`HBuilderX 4.31+` 优先在可视化界面维护。
- 鸿蒙编译后 `plus` 不可用；WebView 通讯优先使用 `WebviewContext.evalJs` + `uni.postMessage` 桥接方案。
- UA 平台定制可使用 `useragent_android` 与 `useragent_ios`，其优先级高于通用 `useragent`。
- App 自定义 UA 配置修改后需重新云端打包生效；不以热更新或浏览器预览结果作为验收依据。
- `titleNView` 与 `tabBar` 的 `blurEffect` 需按配置入口分别声明；`tabBar` 模糊需 `HBuilderX 3.99+`。
- 首次运行到鸿蒙设备会生成 `harmony-configs` 目录；自定义鸿蒙配置需落在该目录下。
- 鸿蒙工程目录路径应避免中文和过长路径，防止工具链构建失败（尤其 Windows）。
- H5 端内嵌 `web-view`、`renderjs`、iOS `WKWebView` 等浏览器内核场景仍会受到 CORS 约束。
- 宽屏适配优先运行时响应式（`match-media`、媒体查询、栅格断点），不以“PC 专用条件编译页面”作为默认路径。
- SSR 执行在服务端时不触发 `onMounted`；同构数据准备需放在可服务端执行的钩子（如 `beforeCreate/created`）并处理副作用边界。
- nvue 组件可按需启用 `render-whole`（默认在 `text/cell/header/cell-slot/recycle-list` 为 `true`）优化排版通讯性能。
- nvue 编译模式建议统一使用 `uni-app`；`weex` 模式仅用于历史迁移，且是项目级开关不支持页面混用。
- nvue 样式编译策略（`nvueStyleCompiler`）建议统一使用 `uni-app`；历史 `weex` 仅用于迁移过渡。
- 启用纯原生渲染（`manifest -> app-plus -> renderer: native`）后，App 端 `vue` 页面会被忽略，发布前需确认页面体系与依赖能力。
- nvue 与 vue 页面通讯优先使用 `uni.$on/uni.$emit`，旧方式（`uni.postMessage`、`plus.webview.postMessageToUniNView`）仅做历史兼容。
- nvue 页面卸载前必须执行 `uni.$off` 清理监听，避免跨页重复触发。
- nvue 中可通过 `uni.requireNativePlugin` 使用原生模块（如 `dom/animation/BindingX`），并按端能力兜底。
- nvue 与 vue 共享数据优先使用状态管理或持久化（`vuex`、`uni.storage`、`globalData`），避免页面对象硬耦合。
- nvue 不支持的 uni API 需替代实现：`uni.createAnimation` -> `animation` 模块，`uni.pageScrollTo` -> `scrollToElement`，`uni.createIntersectionObserver` 需改方案。
- nvue 事件穿透与交互开关（`eventPenetrationEnabled`、`userInteractionEnabled`）仅 iOS 支持，且仅对 `view` 组件生效。
- `longpress/appear/disappear` 事件对象中的 `timestamp` 在 H5 不支持，跨端逻辑需做字段兜底。
- `appear/disappear` 仅在可滚动区域内触发，且 `direction` 仅返回 `up/down`。

## 示例

- 分享、定位、支付等能力走 `platform adapter` 封装。
- H5 不支持能力时给出可替代路径。
- 小程序差异逻辑集中在适配层 `#ifdef MP-WEIXIN` 代码块中。
- 小程序专用图片放 `static/mp-weixin/`，H5 专用资源放 `static/web/`。
- `pages.json` 中按端拆分页面与样式配置，减少业务页面内平台分支。
- 需要分栏展示时，在页面内通过 `uni-row` 与断点实现布局，避免把 `rightWindow` 当作跨端能力。
- H5 SSR 页面中的浏览器对象访问统一延后到客户端阶段，避免服务端渲染报错。
- 需要滚动联动时，在 `nvue` 端改用原生可用方案，不直接复用 `onPageScroll` 逻辑。
- `dialogPage` 弹出页仅影响展示层，不改变主页面 `navigateTo` 路由约定。
- 选择依赖前先验证在 `H5 + 小程序 + App` 的最低目标端是否可运行。
- 同一份 `json` 在 H5/App 打包后字段可按条件编译产生差异。
- 小程序端图片展示统一走 `/static/...` 或 `import` 绑定，避免组件内相对路径差异。
- 需要原生能力时，Android/iOS 走插件封装，鸿蒙端按 UTS 能力适配实现同等接口。
- 鸿蒙端能力接入优先按专题路线拆分：运行与发行、原生 API、原生组件、内置模块。
- 鸿蒙运行包构建优先使用“差量缓存”策略；升级 HBuilderX 或出现异常时使用“清空缓存”重建。
- 真机运行需配置签名证书；`HBuilderX 4.61+` 支持在 IDE 中交互配置并自动申请调试证书。
- 鸿蒙运行模式按目标选择：`debug` 便于断点调试，`release` 便于性能评估。
- 跨端环境检查统一使用条件编译与能力判断，不以 `window` 存在性作为主判断依据。
- App 端读取运行平台时，在 `APP-PLUS` 条件下直接基于 `plus.os.name` 区分 Android/iOS 行为。
- 监听 App 原生事件时使用 `plus.globalEvent.addEventListener('newintent', handler)`。
- 调用 `Native.js` 前先判断平台，再在对应分支内执行 `plus.android.*` 或 `plus.ios.*`。
- `Native.js` 需以真机/自定义基座为准完成回归，不以浏览器预览结果作为验收依据。
- 复杂 DOM 可视化（如 ECharts、地图）优先在 `app-vue/H5` 用 `renderjs` 承载，逻辑层只传最小数据。
- `renderjs` 与逻辑层通信使用 `:prop="state" :change:prop="module.onStateChange"` + `callMethod` 回调。
- 需要鸿蒙原生能力时，页面仅调用 UTS 插件暴露方法，不直接导入 ohpm 包。
- 需要在 WebView 叠放场景展示鸿蒙原生组件时，按文档示例为 `defineNativeEmbed` 设置 `nodeRenderType`。
- 鸿蒙地图接入时先完成腾讯地图 key 配置，再做定位与选点能力联调。
- 鸿蒙 WebView 与页面双向通信时，页面侧使用 `createWebviewContext(...).evalJs` 回调 web 层桥接函数。
- Deep Linking 测试时网页链接形态建议为 `scheme://host?query`，并核对 `module.json5` 中 scheme/host 完全一致。
- App Linking 测试时优先从真实 https 落地页触发，校验“已安装直接唤起、未安装停留网页”的分流行为。
- Deep Linking 调用链路统一为：`canOpenURL -> openSchema -> 失败兜底提示`，避免页面散落端特判。
- App Linking 调用链路统一为：`openSchema(https://...)`，不额外加 `canOpenURL` 预检。
- 拉起鸿蒙元服务时，由 UTS 插件提供稳定接口（如 `openAtomicService`），页面仅传业务参数。
- 鸿蒙元服务支付联调时优先验证 `huawei.mp` 配置；鸿蒙应用支付联调时优先验证 `huawei.app` 配置。
- 鸿蒙应用支付入口建议放在 `#ifdef APP-HARMONY` 条件块内，避免其他端误触发 `createOrder('huawei')`。
- 出现“回调地址未正确配置”时，先同步校验 `notifyUrl` 与 HBuilderX/uniCloud 登录账号一致性。
- 小程序多平台组件联调时，先校验 `usingComponents` 平台节点与组件路径，再校验页面标签命名是否一致。
- 微信模板计算逻辑优先走 `wxs`；支付宝/百度优先走 `sjs`；QQ/字节按 `filter` 约束落地，不强行共用脚本文件。
- 小程序平台能力接入顺序建议为：条件编译保护 -> 平台实现 -> 非目标端兜底提示。
- 微信插件接入顺序建议为：后台添加插件 -> `manifest mp-weixin.plugins` 声明 -> 页面 `usingComponents` 引入 -> 真机验证插件权限与版本。
- 插件页面跳转统一使用插件协议路径（如 `plugin://<插件别名>/<页面或组件标识>`），并按插件文档确认可跳转入口。
- 插件需要的能力权限统一在 `manifest.json -> mp-weixin.permission` 维护，避免只在微信后台配置导致运行时报权失败。
- 插件开发联调顺序建议为：配置 `plugin/plugin.json` -> 使用 `--plugin` 编译 -> 生成插件产物 -> 宿主项目按协议路径联调。
- 需要区分插件与宿主逻辑时，优先使用 `MP-WX-PLUGIN/MP-ALIPAY-PLUGIN` 宏，不在业务代码写运行时平台判断。
- 插件发布前执行一次“关键页面与组件直导入”自检，避免构建后因摇树优化缺页。
- 错误拦截中优先按 `errSubject + errCode` 双键分类，而不是仅按 `errCode` 分支。
- 业务层透传三方 SDK 错误时，统一写入 `cause`，保留源 `code/message/subject`，避免排查断层。
- 需要跨端对齐的错误场景优先复用已有错误码；新增平台特有错误码按尾段约束分配。
- 微信分包异步化联调顺序建议为：校验基础库版本 -> 开启 `lazyCodeLoading` -> 配置 `componentPlaceholder` -> 真机回归首屏与交互。
- 跨分包 JS 公共能力统一封装成 `require` 调用入口，不在业务页混用 `import/require` 两套加载方式。
- 鸿蒙拉起参数处理优先使用 `uni.getLaunchOptionsSync`，区分冷启动与热启动回调行为。
- 需要服务端识别 App 来源时，优先在默认 UA 基础上追加业务标记（`concatenate=true`），避免替换系统关键信息。
- `uni.request/uploadFile/downloadFile` 及 `image/web-view` 相关请求链路需统一验证 UA 是否符合后端网关策略。
- 需要 App 沉浸式视觉时，在 `app-vue` 页面优先评估 `titleNView/tabBar` 的 `blurEffect` 配置。
- H5 请求报跨域时优先确认是否处于浏览器内核链路（页面、web-view、renderjs），再决定代理或服务端改造。
- App 端遇到样式差异时，先确认页面是 `vue` 还是 `nvue`，再按对应渲染机制排查。
- `nvue` 页面布局优先 `flex + px/rpx`，避免直接复用 `vue` 页面的 web 特性单位与选择器。
- 在需要原生组件覆盖与复杂滚动联动时，优先评估 nvue + `list/recycle-list/waterfall/refresh` 组合。
- nvue 与 vue 通讯使用 `uni.$emit('event', payload)` + `uni.$on('event', handler)`，并在页面卸载时 `uni.$off`。
- nvue 滚动定位优先使用 `dom.scrollToElement`，不依赖 `uni.pageScrollTo`。
- iOS 端浮层父容器需要“点透子元素”时，在 `view` 上开启 `eventPenetrationEnabled`，避免吞掉子节点点击。
- 可滚动列表曝光统计优先用 `appear/disappear`，并基于 `direction` 判断滚动方向。

## 反例

- 同一页面存在大量端判断，导致主流程不可读。
- 直接调用端 API，不判断权限和可用性。
- `nvue` 页面复用大量 web 布局写法，导致渲染不一致。
- 多端共用同一路径静态资源，发布后互相覆盖或引用错误。
- 未判断端能力就统一依赖 `onPageScroll`，导致部分端无效。
- 把 `dialogPage` 当成独立路由栈使用，导致返回逻辑混乱。
- 直接引入只支持浏览器环境的库到小程序/App，运行时报 `window` 或 `document` 未定义。
- 误以为多端读取到的 `json` 完全一致，导致端上逻辑分支判断错误。
- 支付宝小程序中沿用 H5 相对图片路径，导致页面图片空白。
- 未区分鸿蒙与 Android/iOS 实现路线，直接复用插件流程导致端能力接入失败。
- 在 `vue2` 项目中直接尝试编译鸿蒙，导致构建链路失败。
- 使用低于 `HBuilderX 4.27` 的版本直接验证鸿蒙构建，导致能力缺失。
- 忽略 DevEco Studio 或版本要求直接运行鸿蒙，导致工具链调用失败。
- 在项目根路径包含中文或路径过长时继续构建鸿蒙工程，导致构建异常。
- 在页面直接 `import` 鸿蒙 ohpm 三方库，导致构建或运行失败。
- 自建插件以 `uni-` 前缀命名或未设置 `app.arkts=true`，导致鸿蒙能力注册失败。
- 未在 `app-harmony/index.uts` 导入 `ets` 定义文件，导致鸿蒙原生组件注册后页面仍不可用。
- `defineNativeEmbed` 使用驼峰 `tag` 或在 `embed` 中事件名不一致，导致组件/事件不生效。
- 鸿蒙编译后继续使用 `plus.webview` 通讯链路，导致 WebView 通信能力失效。
- 地图能力未配置厂商 key 就直接验证定位与选点，导致功能不可用。
- 改写或覆盖原有 `skills[0]` 而非追加 `skills[1]`，导致应用基础拉起能力异常。
- App Linking 场景把 `uris.scheme` 改为自定义值或 `host` 与 AGC 不一致，导致认证唤起失败。
- 未配置 `querySchemes` 就调用 Deep Linking `canOpenURL`，导致返回失败或错误码（如 `17700056`）。
- App Linking 链路先调用 `canOpenURL` 并据此阻断流程，导致已安装应用仍无法拉起。
- 在页面直接调用鸿蒙原生 API 拉起元服务，导致跨端代码污染与维护成本上升。
- 把鸿蒙应用与元服务共用同一个 `clientType`，导致支付渠道识别错误。
- 在客户端仓库明文存储并提交商户私钥，导致密钥泄露风险。
- 鸿蒙应用未启用 `uni-payment` 华为支付能力就直接联调，导致支付渠道不可见。
- `notifyUrl` 指向错误地址或账号不一致仍继续联调，导致回调校验长期失败。
- 在支付宝、百度、QQ、字节小程序里直接复用微信 `wxs`，导致构建通过但运行不生效。
- 仅配置 `wxcomponents` 却期望所有小程序平台都能加载原生组件，导致多端组件缺失。
- 小程序专属 API 未做 `MP-*` 条件编译，导致其他端出现未定义异常。
- 多平台组件共用同一组件别名但路径不同步，导致真机端加载错组件。
- 微信插件只在 `pages.json` 配了 `plugin://`，但漏配 `manifest mp-weixin.plugins`，导致构建或运行期找不到插件。
- 把百度动态库仍按 `plugins/plugin://` 配置，导致百度端组件无法解析。
- 同一插件同时挂在多个分包声明，导致分包插件能力冲突。
- 分包外页面直接跳分包插件页，导致路由失败。
- 插件文档示例版本已下线仍照抄，导致“插件版本不存在”。
- 插件工程未配置 `plugin/plugin.json` 或 `main` 入口错误，导致插件构建产物不可用。
- 按普通小程序命令编译插件（未加 `--plugin`），导致输出目录缺失插件结构。
- 插件代码与宿主代码未做宏隔离，导致宿主构建包含插件专属逻辑。
- 插件页面/组件未做 `main.js` 直导入保留，导致发布后关键能力丢失。
- 错误对象只返回 `errCode/errMsg` 而无 `errSubject`，导致跨模块错误码冲突无法归因。
- 在 UTS/uvue 直接抛字符串或普通对象，导致统一错误拦截与统计链路失效。
- 多个源错误直接拼接到 `errMsg` 文本中，不使用 `cause/UniAggregateError`，导致结构化排障失败。
- 自定义平台错误码尾段随意分配，导致与其他端或模块冲突。
- 未开启 `lazyCodeLoading` 就按分包异步化排查首屏问题，导致优化方向偏差。
- 分包异步化页面未配置 `componentPlaceholder` 或占位组件体积过大，导致加载阶段白屏卡顿。
- 在分包异步化项目中使用 `vue3` 页面链路，导致组件加载行为异常。
- 跨分包 JS 使用 `import` 或动态 `import()`，导致运行期找不到模块。
- 在小程序/App 直接访问 `window`、`document`，导致运行时报未定义错误。
- 把 `vue` 页面 CSS 兼容问题按 `nvue` 机制处理，导致定位方向错误。
- 在 `nvue` 页面直接使用 `vh/vw/rem` 等 web 依赖单位，出现端上布局偏差。
- 在 `style/template` 里使用 `// #ifdef` 注释，导致条件编译块不生效。
- 试图在 `static` 文件内容里写 `#ifdef`，导致资源未按预期区分平台。
- 在 H5/小程序直接访问 `plus.os.name`，导致运行时报 `plus is not defined`。
- 在 uni-app 中继续监听 `plusready`，导致回调不触发。
- 在 uni-app 中用 `document.addEventListener` 监听原生事件，导致事件失效。
- 在未区分 `APP-ANDROID/APP-IOS` 的情况下直接调用 `Native.js`，导致端上崩溃或无效。
- 用 `Native.js` 处理 UI/webview 逻辑，导致能力不生效且维护复杂。
- 在小程序或 `nvue` 页面继续使用 `renderjs`，导致代码不执行。
- 在 `renderjs` 里直接承载业务状态与请求主链路，导致通信复杂且难以维护。
- 通过 `src` 外链脚本定义 `renderjs`，导致模块不生效。
- 直接替换默认 UA（`concatenate=false`）且未评估后端依赖，导致网关识别与统计链路异常。
- 修改 `useragent` 后未重新云打包就上线验证，导致“配置无效”误判。
- 在 `nvue` 页面或 H5 端继续配置 `blurEffect` 期望生效，导致界面行为与预期不一致。
- `blurEffect` 场景下继续使用 `rgba/gradient` 背景，导致模糊效果无效或异常。
- 把 H5 跨域问题当成小程序/App `uni.request` 的通用问题处理，导致排查方向错误。
- 把 `leftWindow/rightWindow/topWindow` 当作 App/小程序通用布局能力，导致多端表现不一致。
- 为了宽屏适配整页复制一套 PC 条件编译代码，导致平板场景维护成本失控。
- 把 `window/document` 访问写在 SSR 首屏渲染路径，导致服务端崩溃或 hydration 不一致。
- 在非 App 项目大量引入 nvue，导致样式受限却无性能收益。
- 在 nvue 场景继续用 `scroll-view` 承载超长区域列表，导致性能不达预期。
- 开启 `renderer:native` 后仍保留关键 `vue` 页面链路，导致线上页面丢失。
- nvue 样式编译与页面编译策略混用（`uni-app/weex` 混搭），导致样式行为不一致。
- nvue 页面不做 `uni.$off` 清理监听，导致多次进入页面后事件重复触发。
- 在 nvue 里继续使用 `uni.createAnimation`、`uni.pageScrollTo`、`uni.createIntersectionObserver`，导致功能无效。
- 把 `eventPenetrationEnabled/userInteractionEnabled` 当作全端能力使用，导致 Android/H5 行为与预期不一致。
- 在 H5 端依赖 nvue 事件对象 `timestamp` 参与核心逻辑，导致字段缺失异常。

## 检查项

- 端差异是否集中管理。
- 条件编译块是否最小化且可读。
- 降级路径是否可验证、可回退。
- 页面主流程中是否存在大量平台分支判断。
- 端特有资源是否已按平台目录隔离。
- 滚动交互在 `nvue` 等受限端是否有替代方案。
- `uni-app x` 页面弹窗能力是否与普通路由职责区分清楚。
- 关键第三方依赖是否有跨端兼容结论与替代方案。
- `json` 条件编译差异是否已在目标端验证。
- `pages.json/manifest.json` 的平台差异是否通过条件编译管理而非页面内硬编码。
- 资源路径在支付宝小程序组件场景是否已通过真机验证。
- 原生能力是否已区分 Android/iOS 与鸿蒙的实现路线与测试清单。
- 鸿蒙目标项目是否满足 `HBuilderX 4.27+` 与 `vue3` 前置条件。
- 鸿蒙运行环境（DevEco 版本、模拟器 API/真机 API）是否满足当前项目要求。
- `harmony-configs` 是否已生成且自定义配置已正确落位。
- 鸿蒙能力是否优先复用插件市场 UTS 插件，避免重复造轮子。
- 自建鸿蒙 UTS 插件是否完成 `uni-ext-api` 与 `app.arkts=true` 配置。
- 鸿蒙三方库调用链路是否满足“pages 调 UTS 插件、UTS 插件调 ohpm”约束。
- 鸿蒙原生组件是否满足 `HBuilderX 4.62+`、`ets` 定义与 `index.uts` 导入链路。
- `embed tag/options/event` 绑定是否与 `defineNativeEmbed` 定义一致（含 `options` 重新赋值策略）。
- WebView 叠放需求是否已验证 `nodeRenderType` 配置行为。
- 鸿蒙地图链路是否已配置腾讯地图 key，并在当前 HBuilderX 版本按推荐入口维护。
- 鸿蒙 WebView 通讯是否已切换 `WebviewContext.evalJs` 与 `uni.postMessage` 桥接实现。
- URL Scheme 配置是否采用 `skills` 追加策略，且 `actions/scheme/host` 字段满足约束。
- App Linking 是否完成 AGC、`applinking.json`、`module.json5` 三端一致性校验。
- `querySchemes` 是否声明在 `module.json5` 根节点且数量不超过 50。
- Deep Linking 是否执行 `canOpenURL` 预检并对失败分支提供兜底提示。
- App Linking 是否直接使用 `openSchema`，且未误接入 `canOpenURL` 判断。
- 元服务拉起是否通过 UTS 插件统一封装，页面层无原生 API 直调。
- `uni-pay/config.js` 是否按端正确填写 `huawei.mp/mp-harmony` 与 `huawei.app/app-harmony`。
- `mchId/mchAuthId/mchPrivateKey/platformPublicKey` 是否来自对应商户后台并完成格式校验。
- `notifyUrl` 是否指向当前项目 uniCloud 地址，且 HBuilderX 与云端登录账号一致。
- 鸿蒙应用是否在 `manifest.json -> uni-payment` 启用华为支付，并完成签名环境验证。
- `pages.json` 的 `usingComponents` 是否按目标小程序平台键正确配置，且路径在对应端可解析。
- 小程序脚本能力是否按平台使用 `wxs/sjs/filter`，并完成真机回归。
- 小程序专属 API 是否全部受 `MP-*` 条件编译保护，且非目标端有兜底逻辑。
- 多平台组件标签命名是否唯一且与 `usingComponents` 映射一致。
- `manifest` 中插件声明是否按平台使用 `plugins/dynamicLib` 正确落位，`version/provider` 与后台一致。
- 微信插件组件是否通过 `plugin://` 协议接入，百度动态库是否通过 `dynamicLib://` 接入。
- 插件所需权限是否在 `mp-weixin.permission` 配齐，并覆盖真机授权流程。
- 分包插件是否满足“单插件单分包引用”与“分包外不可直跳插件页”约束。
- 插件版本是否为当前可用版本，且不依赖已下线示例版本号。
- 插件工程是否包含有效 `plugin/plugin.json`，且 `main/publicComponents/pages` 路径可解析。
- 插件构建命令是否使用 `--plugin <目录名>`，并验证输出目录符合插件产物结构。
- 插件与宿主代码是否通过 `MP-WX-PLUGIN/MP-ALIPAY-PLUGIN` 做条件编译隔离。
- 插件关键页面与组件是否通过 `main.js` 直导入规避摇树裁剪。
- 异步 API 返回错误是否统一为 `UniError`，且至少包含 `errSubject/errCode/errMsg`。
- 错误码分配是否遵循 7 位规范与平台尾段规则（`5xx/6xx/7xx/8xx/9xx`）。
- `errSubject` 命名是否符合 `uni-API` 或 `插件id-API` 约定且无重名。
- 源错误是否通过 `SourceError/UniAggregateError` 写入 `cause` 并保留上下游链路。
- 微信分包异步化是否满足基础库 `2.11.2+` 且 `lazyCodeLoading` 已生效。
- 分包异步化页面是否配置 `componentPlaceholder` 且占位组件满足“轻量可见”要求。
- 分包异步化项目是否规避 `vue3` 路线并完成能力边界说明。
- 跨分包 JS 是否全部使用 `require('../sub-package/...')`，且无静态/动态 `import` 残留。
- 拉起参数是否在冷启动/热启动路径都完成验证（含 `uni.getLaunchOptionsSync` 读取）。
- 是否存在直接依赖浏览器全局对象的跨端代码。
- App 页面渲染问题是否已按 `vue/nvue` 机制区分排查。
- 样式实现是否已按 `vue/nvue/uvue` 能力边界做差异化设计。
- 样式和模板中的条件编译注释语法是否正确（HTML/CSS 注释而非 JS 注释）。
- App 端 `plus` 能力调用是否包含 `APP-PLUS` 端判断，且未误用 `plusready` 监听。
- App 原生事件监听是否统一使用 `plus.globalEvent.addEventListener`。
- `Native.js` 调用是否仅用于遗留兜底，且新需求已优先评估原生插件/UTS。
- `Native.js` 是否完成 Android/iOS 分支隔离与真机回归验证。
- `renderjs` 是否仅用于 `app-vue/H5`，且非支持端已有替代实现（`wxs/sjs` 或纯逻辑层方案）。
- `renderjs` 与逻辑层通信是否通过 `props + callMethod`，并验证 `methods` 绑定有效。
- `renderjs` 脚本是否为内联声明且高频通信已做节流/批量化。
- UA 配置是否区分“追加 vs 替换”策略，并验证后端依赖字段未丢失。
- `useragent_android/useragent_ios` 与通用 `useragent` 的覆盖关系是否已在双端真机回归。
- UA 变更是否已通过云端打包生效并覆盖关键请求链路（接口、上传下载、web-view）。
- `blurEffect` 是否仅用于 `app-vue`，且 `titleNView/tabBar` 配置入口正确。
- `blurEffect` 场景下是否规避 `rgba/gradient` 并完成 Android/iOS 真机回归。
- `tabBar blurEffect` 是否满足 `HBuilderX` 版本门槛并验证暗黑模式表现。
- 是否已明确当前请求链路是否受浏览器 CORS 约束（H5/web-view/renderjs/WKWebView）。
- web 窗体能力是否被限制在 web 端，跨端布局是否改为组件化实现。
- 宽屏适配是否优先走运行时响应式而非平台条件编译分叉。
- SSR/H5 代码路径是否已隔离浏览器依赖，且同构生命周期使用正确。
- nvue 引入是否基于明确性能场景，而非默认替代全部 `vue` 页面。
- `nvueCompiler` 与 `renderer` 配置是否与项目目标端能力一致。
- `nvueStyleCompiler` 是否与项目当前 nvue 能力预期一致并完成回归。
- nvue 性能组件（`list/recycle-list/waterfall/refresh`）是否用于高负载滚动场景验证。
- nvue 与 vue 通讯是否统一使用 `uni.$on/$emit` 且监听已在卸载时清理。
- nvue 不支持 API 是否均有替代方案并完成真机验证。
- nvue iOS 专属事件能力（`eventPenetrationEnabled/userInteractionEnabled`）是否有端判断与降级方案。
- `appear/disappear` 是否绑定在可滚动容器内元素，且 `timestamp/direction` 字段兼容已验证。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/project.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-path.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-script.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-json.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-static-assets.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/plugin/native-plugin.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/native-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/history.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/intro.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/runbuild.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/native-component.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/built-in-module.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/url-scheme.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/harmony/open-app.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/mp-harmony/payment.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/miniprogram-subject.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/miniprogram-subcontract-asynchrony.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/mp-weixin-plugin.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/mp-weixin-plugin-dev.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/err-spec.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-js.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-css.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/platform.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/adapt.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/ssr.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/nvue-outline.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/nvue-css.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/nvue-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/nvue-event.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/use-html5plus.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/native-js.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/renderjs.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/app-useragent.html
- 官方教程（2026-02-12 查阅）：https://uniapp.dcloud.net.cn/tutorial/app-blureffect.html
