# Slice 模块业务定义

## 适用范围

- 图片网格切片功能的需求定义、实现边界和验收标准。

## 功能目标

- 上传图片。
- 输入切片行数和列数。
- 基于 Canvas 生成网格切片结果。
- 预览每一张切片。
- 下载切片结果。

## 约束

- 目标平台：H5 + 微信小程序 + Android App + iOS App。
- 仅使用前端 Canvas 实现切片，不依赖后端切图服务。
- 页面层不直接写复杂切图逻辑，核心逻辑封装在 `src/utils/image.ts`。
- 输入参数必须校验：`rows > 0`、`cols > 0`、均为整数。
- App 端需处理相册/文件权限与保存能力差异（Android/iOS 分端验证）。

## 主流程

1. 用户上传单张图片。
2. 用户输入 `rows` 与 `cols`。
3. 系统校验输入与图片可用性。
4. 调用切片算法，生成切片数据集合。
5. 页面展示切片预览并提供下载动作。

## 关键规则

- 切片顺序默认按“从上到下、从左到右”输出。
- 当图片宽高无法整除行列时，按向下取整切分，剩余像素归并到最后一行/列。
- 失败场景要给出可读错误信息（如图片加载失败、参数非法、Canvas 不可用）。
- 导出逻辑统一收敛在 `src/utils/exporter.ts`，页面仅负责触发与提示。
- 导出文件名遵循 `slice-r{row}-c{col}-{index}.png` 规则，便于定位切片来源。

## 平台导出策略

- H5：触发浏览器下载。
- 微信小程序：保存到系统相册，首次导出需处理相册权限。
- Android/iOS App：保存到系统相册，并对失败分支给出提示。

## 异常分支约束

- 导出失败需区分“权限拒绝”与“普通保存失败”，避免统一报错文案。
- 检测到权限拒绝时停止后续切片保存，并给出“去系统设置授权”的明确提示。
- 普通保存失败需要返回失败数量，页面展示“成功数/失败数”。

## 成功标准

- 输入图片 `1000x1000`，`rows=2`、`cols=2`，输出 4 张切片。
- 每张切片理论尺寸为 `500x500`（含边界归并规则时需符合实现定义）。
- H5、微信小程序、Android App、iOS App 均可完成“上传 -> 切片 -> 预览 -> 下载/保存”主链路。

## 非目标（当前阶段不做）

- 批量图片切片。
- gap/间距切片。
- Zip 打包下载。
- 云端存储与后端任务队列。

## 依赖文档

- `docs/01-项目结构.md`
- `docs/05-组件与样式规范.md`
- `docs/06-多端差异处理.md`
- `docs/07-打包发布.md`
