# 17 Vue3 组件实践

## 适用范围

- 在 uni-app Vue3 项目中设计组件接口、封装复用能力、规范 `script setup` 组件写法时使用。

## 规则

- Vue3 组件优先使用 `script setup`，并显式声明 `defineProps` 与 `defineEmits`。
- `props` 定义优先类型化与默认值约束，禁止在子组件中直接修改 `props`。
- 组件对外暴露实例能力时使用 `defineExpose`，避免隐式依赖内部实现。
- 插槽使用 `slots` 语义组织，具名插槽与默认插槽职责要清晰，避免混写导致作用域混乱。
- 父子深层通信优先 `provide/inject` 或状态层方案，避免多级 `props/emit` 传递噪音。
- 组件逻辑按“输入（props）-处理（state/computed）-输出（emit/slot）”组织，保持可测试性。
- 组件副作用（监听、订阅、计时器）必须在卸载阶段可清理。
- 平台差异能力通过组件适配层封装，不在业务页面重复判断。

## 示例

- 组件通过 `defineProps` 声明输入，`defineEmits` 声明 `submit/cancel` 输出事件。
- 父组件通过 `ref + defineExpose` 调用子组件公开方法，而非读取私有状态。
- 表单基础组件通过具名插槽扩展头部/尾部区域，核心逻辑保持稳定。

## 反例

- 未声明 `emits` 直接 `$emit` 多事件，导致组件契约不清晰。
- 父组件直接依赖子组件内部状态字段，版本调整后大面积破坏。
- 多层级链路全部依赖 `props` 透传，导致维护困难与耦合升高。
- 页面中散落平台判断，组件无法复用到其他端。

## 检查项

- 组件接口是否完成 `props/emits` 显式声明并文档化。
- 对外能力是否通过 `defineExpose` 最小化暴露。
- 插槽与事件语义是否稳定、可预测。
- 深层通信是否采用合适方案（`provide/inject` 或状态层）。
- 组件是否具备可回收副作用与跨端复用能力。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-components.html
