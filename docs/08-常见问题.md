# 08 常见问题

## 适用范围

- 出现白屏、路由失败、接口异常、端差异问题时使用。

## 规则

- 排查顺序固定：配置 -> 路由 -> 请求 -> 状态 -> 平台能力。
- 先复现再修复，记录复现条件与日志。
- 修复后补最小回归用例，避免同类问题反复出现。
- 页面初始化尽量先渲染框架结构，再异步补数据，降低白屏感知时间。
- 页面转场卡顿优先排查：`onLoad/onShow` 重逻辑、`onPageScroll` 高频样式改动、首屏静态 DOM 过大。
- 静态资源与页面跳转异常优先排查“运行时路径是否误用相对路径”。
- 组件未渲染优先排查：组件引用方式（easycom/显式导入）是否与当前写法匹配。
- 脚本导入异常优先排查：`js` 引用是否误用了 `/` 开头路径、`node_modules` 是否在项目根目录。
- 样式未生效优先排查：`@import` 是否写在 `<style>` 内、路径是否为相对路径、语句是否以 `;` 结束。
- `json` 导入异常优先排查：路径写法（相对路径或 `@/`）与别名语义（uni-app/CLI）是否一致。
- 静态资源异常优先排查：是否误把非 `static` 资源当作模板直链路径使用。
- 平台报错优先排查：是否误用浏览器全局对象（`window/document/navigator`）导致非 H5 端异常。
- 样式兼容异常优先排查：是否混用 `vue` 与 `nvue` 的 CSS 能力边界（单位、选择器、全局样式）。
- Vue 渲染异常优先排查：`v-for` 的 `key` 是否稳定、`v-if/v-show` 是否误用、事件回调是否写入复杂表达式。
- 组件通信异常优先排查：`props` 是否被子组件直接修改、`$emit` 事件名是否一致、插槽作用域是否误解。
- 生命周期异常优先排查：`onLoad/onShow/onUnload` 职责是否混用、副作用是否未清理。
- 组合式 API 异常优先排查：`setup` 中是否误用 `this`、`reactive` 解构后是否丢失响应性、`watch` 是否缺少清理。
- Vue3 迁移异常优先排查：`v-model` 新语义、`v-bind` 合并顺序、`v-if/v-for` 同节点行为是否按 Vue3 规则实现。
- Vue3 组件异常优先排查：`defineProps/defineEmits` 是否声明完整、`defineExpose` 是否暴露最小接口、插槽语义是否清晰。
- Vue3 API 异常优先排查：`toRefs` 是否漏用、`nextTick` 时机是否正确、`getCurrentInstance` 是否被滥用。
- 组合式页面钩子异常优先排查：是否误用 `onShow/onHide`，应改为 `onPageShow/onPageHide`。
- 组合式 API 导入异常优先排查：是否把 `vue` 与 `@dcloudio/uni-app` 的 API 来源混用。
- Vuex 异常优先排查：`main.js` 是否执行 `app.use(store)`、`nvue createApp` 是否返回 `Vuex`。
- Vuex 更新异常优先排查：是否绕过 `mutation` 直接改 `state`，或在 `mutation` 中执行异步逻辑。
- Pinia 异常优先排查：`main.js` 是否执行 `createPinia` 并 `app.use(pinia)`。
- Pinia 响应性异常优先排查：是否直接解构 store 状态而未使用 `storeToRefs`。
- Pinia 在 `nvue` 页面异常优先排查：`createApp` 返回值是否包含 `Pinia`。

## 示例

- 页面白屏：先查 `pages.json` 注册，再查编译报错。
- 接口 401：先查 token 注入，再查登录态恢复流程。
- 白屏优化：首屏只保留必要节点，复杂模块延后加载并加骨架占位。
- 卡顿优化：把非首屏请求放到首屏渲染后，滚动事件里只做轻量状态更新。
- 图片 404：先检查 `src` 是否为 `/static/...` 绝对路径，再检查资源是否真实存在。
- 跳转失败：先检查 `url` 是否为 `/pages/...` 绝对路径，再检查 `pages.json` 注册。
- 组件不生效：先检查标签命名是否命中 easycom，再检查是否需要显式导入与注册。
- 脚本导入失败：先把 `/common/a.js` 改成 `@/common/a.js` 或相对路径，再检查别名配置。
- 第三方库报错：若提示 `window/document` 未定义，先判定该库是否仅支持 H5。
- 样式不生效：先检查 `@import "./index.css";` 写法，再检查样式文件相对路径是否正确。
- `json` 读取异常：先确认 `import` 路径，再确认目标平台条件编译后字段是否存在。
- 图片不显示：先确认资源在 `static`（可直链）还是非 `static`（需 `import` 绑定）。
- `window is not defined`：先定位调用点，再改为 `uni` API、条件编译或平台适配层实现。
- App 样式异常：先确认页面是 `vue` 还是 `nvue`，按渲染机制分别排查。
- 小程序样式丢失：先确认背景图/字体是否使用受限本地路径，再改为网络地址或端内可用方案。
- 列表显示错乱：先检查 `v-for` 的 `key` 是否使用业务唯一标识。
- 子组件状态不同步：先检查是否直接修改了 `prop`，再检查父组件是否监听对应 `$emit` 事件。
- 页面返回卡顿：先检查 `onShow` 是否重复执行重逻辑，再检查定时器/监听是否重复注册。
- 数据不更新：先检查是否对 `reactive` 直接解构使用，再改为 `toRefs` 或保持对象引用。
- 双向绑定失效：先确认组件是否声明 `modelValue` 与 `update:modelValue` 事件。
- 子组件方法不可调用：先确认是否通过 `defineExpose` 显式暴露，再检查父组件 `ref` 使用时机。
- 视图读取异常：先检查是否在渲染完成前读取节点，必要时补 `nextTick`。
- 组合式页面不触发显隐逻辑：先检查是否使用 `onPageShow/onPageHide`，避免继续沿用 `onShow/onHide`。
- 组合式 API 报导入错误：先检查 API 来源，页面生命周期从 `@dcloudio/uni-app` 导入，响应式能力从 `vue` 导入。
- 页面报 `$store` 未定义：先检查入口是否 `app.use(store)`，再检查模块导出与引入路径。
- `mapState/mapActions` 在 `nvue` 不生效：先检查 `createApp` 返回值是否包含 `Vuex`。
- Pinia 状态更新后页面不刷新：先检查状态字段是否通过 `storeToRefs` 解构。
- Options API 页面无法映射 Pinia：先检查是否使用 `mapState/mapWritableState/mapActions` 且传入 `useXxxStore`。

## 反例

- 未定位根因直接改代码，导致症状迁移。
- 只在一个端验证就关闭问题单。
- 进入页面立即执行多段同步计算，阻塞首屏渲染。
- 在 `onPageScroll` 中频繁改动布局与样式，导致滑动掉帧。
- 在组件内用 `../static/a.png` 动态拼接路径，迁移页面后大量资源失效。
- Options API 页面只 `import` 不注册组件，运行时出现未定义告警。
- 在 uni-app 项目中把 `node_modules` 放进子目录，导致构建和运行时模块找不到。
- 在样式里写 `@import "/styles/base.css"` 或省略分号，导致编译或加载失败。
- 在 CLI 项目中错误理解 `@` 指向，导入 `json` 时频繁报模块不存在。
- 在模板中直接引用非 `static` 路径，某些端构建后资源丢失。
- 在小程序/App 代码里直接访问 `window/document`，上线后主流程报错。
- 在 `nvue` 页面使用 `vh/vw/rem` 或 web 选择器特性，导致布局与样式异常。
- 列表项使用随机值或索引作为 `key`，导致局部更新后状态错位。
- 子组件直接改 `prop` 或依赖 `.native` 事件做跨端统一处理，导致行为不稳定。
- 页面卸载后未清理定时器或订阅，导致多次进入后逻辑叠加。
- 在 `setup` 中访问 `this` 或滥用 `watchEffect` 重请求，导致运行时异常与性能抖动。
- 按 Vue2 习惯处理 `v-model` 或 `v-bind` 覆盖顺序，导致 Vue3 端行为异常。
- Vue3 组件未声明 `emits` 或滥用多级 props 透传，导致契约不清晰与调试困难。
- 直接解构 `reactive` 字段且未使用 `toRefs`，导致状态更新不生效。
- 在组合式页面里继续用 `onShow/onHide` 监听页面显隐，导致钩子不触发或语义混乱。
- 把页面生命周期 API 从 `vue` 导入，或把响应式 API 从 `@dcloudio/uni-app` 导入，导致运行时/类型异常。
- 在组件中直接改 `store.state` 或在 `mutation` 里写异步请求，导致状态流不可追踪。
- Vuex 模块不开 `namespaced` 却跨模块同名提交，导致状态和调用混乱。
- 直接从 Pinia store 解构状态字段并在模板使用，导致响应性丢失。
- 只在 `setup` 注入 Pinia 但未在入口 `app.use(pinia)`，导致页面拿不到 store。

## 检查项

- 是否有清晰复现步骤与结论。
- 根因是否被确认并可解释。
- 是否有回归验证结果与风险说明。
- 首屏渲染时长是否可接受，是否存在明显白屏。
- 页面切换与滚动是否有掉帧或卡顿。
- 动态资源路径和跳转路径是否统一为运行时绝对路径。
- 组件引用方式是否与页面写法一致且可命中（easycom 或显式导入注册）。
- `js` 模块路径与第三方依赖位置是否符合规范。
- 样式 `@import` 写法是否符合规范（位置/路径/分号）。
- `json` 路径与字段在目标端是否可用（含条件编译差异）。
- 资源路径是否符合“`static` 直链、非 `static` import 后绑定”规则。
- 是否存在浏览器全局对象误用，及 `vue/nvue` 渲染机制误判问题。
- 是否存在 `vue/nvue` 样式能力混用、及小程序资源路径受限问题。
- 是否存在 Vue 基础指令误用导致的渲染与交互异常。
- 组件通信与插槽语义是否符合单向数据流和作用域规则。
- 生命周期与实例 API 使用是否符合页面阶段与平台能力边界。
- 组合式 API 是否正确处理响应性边界与副作用清理。
- Vue3 语义变更点是否已逐项校验并完成回归。
- Vue3 组件接口（props/emits/expose/slots）是否有清晰边界并可回归验证。
- Vue3 API 时机与响应性处理（`toRefs/nextTick/getCurrentInstance`）是否符合规范。
- 组合式页面显隐监听是否使用 `onPageShow/onPageHide` 而非 `onShow/onHide`。
- Vue3 组合式 API 导入来源是否清晰区分 `vue` 与 `@dcloudio/uni-app`。
- Vuex 注入链路是否完整（`app.use(store)`、`nvue` 返回 `Vuex`）。
- Vuex 是否保持“异步 action、同步 mutation”的约束。
- Pinia 注入链路是否完整（`createPinia`、`app.use(pinia)`、`nvue` 返回 `Pinia`）。
- Pinia 状态消费是否通过 `storeToRefs` 或保持 store 原引用访问。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-path.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-component.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-script.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-style.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-json.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-static-assets.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-js.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-css.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-basics.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-components.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-composition-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-components.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-composition-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-vuex.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-pinia.html
