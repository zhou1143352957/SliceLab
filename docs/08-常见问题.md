# 08 常见问题

## 适用范围

- 出现白屏、路由失败、接口异常、端差异问题时使用。

## 规则

- 排查顺序固定：配置 -> 路由 -> 请求 -> 状态 -> 平台能力。
- 先复现再修复，记录复现条件与日志。
- 修复后补最小回归用例，避免同类问题反复出现。
- 页面初始化尽量先渲染框架结构，再异步补数据，降低白屏感知时间。
- 页面转场卡顿优先排查：`onLoad/onShow` 重逻辑、`onPageScroll` 高频样式改动、首屏静态 DOM 过大。
- 静态资源与页面跳转异常优先排查“运行时路径是否误用相对路径”。
- 组件未渲染优先排查：组件引用方式（easycom/显式导入）是否与当前写法匹配。
- 脚本导入异常优先排查：`js` 引用是否误用了 `/` 开头路径、`node_modules` 是否在项目根目录。
- 样式未生效优先排查：`@import` 是否写在 `<style>` 内、路径是否为相对路径、语句是否以 `;` 结束。
- `json` 导入异常优先排查：路径写法（相对路径或 `@/`）与别名语义（uni-app/CLI）是否一致。
- 静态资源异常优先排查：是否误把非 `static` 资源当作模板直链路径使用。
- 平台报错优先排查：是否误用浏览器全局对象（`window/document/navigator`）导致非 H5 端异常。
- 样式兼容异常优先排查：是否混用 `vue` 与 `nvue` 的 CSS 能力边界（单位、选择器、全局样式）。
- Vue 渲染异常优先排查：`v-for` 的 `key` 是否稳定、`v-if/v-show` 是否误用、事件回调是否写入复杂表达式。
- 组件通信异常优先排查：`props` 是否被子组件直接修改、`$emit` 事件名是否一致、插槽作用域是否误解。
- 生命周期异常优先排查：`onLoad/onShow/onUnload` 职责是否混用、副作用是否未清理。
- 组合式 API 异常优先排查：`setup` 中是否误用 `this`、`reactive` 解构后是否丢失响应性、`watch` 是否缺少清理。
- Vue3 迁移异常优先排查：`v-model` 新语义、`v-bind` 合并顺序、`v-if/v-for` 同节点行为是否按 Vue3 规则实现。
- Vue3 组件异常优先排查：`defineProps/defineEmits` 是否声明完整、`defineExpose` 是否暴露最小接口、插槽语义是否清晰。
- Vue3 API 异常优先排查：`toRefs` 是否漏用、`nextTick` 时机是否正确、`getCurrentInstance` 是否被滥用。
- 组合式页面钩子异常优先排查：是否误用 `onShow/onHide`，应改为 `onPageShow/onPageHide`。
- 组合式 API 导入异常优先排查：是否把 `vue` 与 `@dcloudio/uni-app` 的 API 来源混用。
- Vuex 异常优先排查：`main.js` 是否执行 `app.use(store)`、`nvue createApp` 是否返回 `Vuex`。
- Vuex 更新异常优先排查：是否绕过 `mutation` 直接改 `state`，或在 `mutation` 中执行异步逻辑。
- Pinia 异常优先排查：`main.js` 是否执行 `createPinia` 并 `app.use(pinia)`。
- Pinia 响应性异常优先排查：是否直接解构 store 状态而未使用 `storeToRefs`。
- Pinia 在 `nvue` 页面异常优先排查：`createApp` 返回值是否包含 `Pinia`。
- Vue3 迁移构建异常优先排查：是否仍保留 `require/module.exports`、`Vue.prototype` 等 Vue2 写法。
- 小程序迁移事件异常优先排查：是否继续使用 `.native` 或 `click`，以及是否需要 `data-eventsync`。
- 迁移后白屏优先排查：`manifest.json` 中微信小程序 `optimization.minified` 是否开启。
- TypeScript 报错优先排查：`typescript/@dcloudio/types` 是否安装，`tsconfig` 是否配置 `types: ["@dcloudio/types"]`。
- TS 组件链路异常优先排查：`<script lang="ts">` 页面在 Vue2 兼容链路下是否引用了无 TS 能力组件。
- JSX 构建异常优先排查：`vite` 是否启用 `@vitejs/plugin-vue-jsx`，插件版本是否与 `vite` 匹配。
- JSX 端兼容异常优先排查：是否把 JSX 组件用于不支持的端（如小程序）。
- 条件编译异常优先排查：是否误用平台宏、是否把 `#ifdef` 写在不支持的位置。
- 样式/模板条件编译异常优先排查：注释是否用 HTML/CSS 语法，而非 JS 注释。
- App 平台判断异常优先排查：`plus.*` 调用是否在 `plusready` 之后，且限定 `APP-PLUS` 端执行。
- H5 跨域异常优先排查：是否为浏览器同源策略拦截、服务端是否放开来源与预检请求。
- 跨域定位优先排查：当前是否处于浏览器内核链路（H5/web-view/renderjs/WKWebView）。
- 宽屏适配异常优先排查：当前是否误把等比缩放当作默认方案，是否缺少局部拉伸布局。
- `rpx` 异常优先排查：`pages.json` 的 `rpxCalc*` 参数是否与设计基准一致。
- 分栏布局异常优先排查：是否误把 `leftWindow/rightWindow/topWindow` 用在非 web 端。
- SSR 首屏异常优先排查：`manifest` 的 `h5.ssr` 是否启用、`uni-ssr` 云函数与静态资源是否同版本发布。
- SSR 数据异常优先排查：同构代码是否在服务端与客户端执行出不同结果（时间、随机数、环境分支）。

## 示例

- 页面白屏：先查 `pages.json` 注册，再查编译报错。
- 接口 401：先查 token 注入，再查登录态恢复流程。
- 白屏优化：首屏只保留必要节点，复杂模块延后加载并加骨架占位。
- 卡顿优化：把非首屏请求放到首屏渲染后，滚动事件里只做轻量状态更新。
- 图片 404：先检查 `src` 是否为 `/static/...` 绝对路径，再检查资源是否真实存在。
- 跳转失败：先检查 `url` 是否为 `/pages/...` 绝对路径，再检查 `pages.json` 注册。
- 组件不生效：先检查标签命名是否命中 easycom，再检查是否需要显式导入与注册。
- 脚本导入失败：先把 `/common/a.js` 改成 `@/common/a.js` 或相对路径，再检查别名配置。
- 第三方库报错：若提示 `window/document` 未定义，先判定该库是否仅支持 H5。
- 样式不生效：先检查 `@import "./index.css";` 写法，再检查样式文件相对路径是否正确。
- `json` 读取异常：先确认 `import` 路径，再确认目标平台条件编译后字段是否存在。
- 图片不显示：先确认资源在 `static`（可直链）还是非 `static`（需 `import` 绑定）。
- `window is not defined`：先定位调用点，再改为 `uni` API、条件编译或平台适配层实现。
- App 样式异常：先确认页面是 `vue` 还是 `nvue`，按渲染机制分别排查。
- 小程序样式丢失：先确认背景图/字体是否使用受限本地路径，再改为网络地址或端内可用方案。
- 列表显示错乱：先检查 `v-for` 的 `key` 是否使用业务唯一标识。
- 子组件状态不同步：先检查是否直接修改了 `prop`，再检查父组件是否监听对应 `$emit` 事件。
- 页面返回卡顿：先检查 `onShow` 是否重复执行重逻辑，再检查定时器/监听是否重复注册。
- 数据不更新：先检查是否对 `reactive` 直接解构使用，再改为 `toRefs` 或保持对象引用。
- 双向绑定失效：先确认组件是否声明 `modelValue` 与 `update:modelValue` 事件。
- 子组件方法不可调用：先确认是否通过 `defineExpose` 显式暴露，再检查父组件 `ref` 使用时机。
- 视图读取异常：先检查是否在渲染完成前读取节点，必要时补 `nextTick`。
- 组合式页面不触发显隐逻辑：先检查是否使用 `onPageShow/onPageHide`，避免继续沿用 `onShow/onHide`。
- 组合式 API 报导入错误：先检查 API 来源，页面生命周期从 `@dcloudio/uni-app` 导入，响应式能力从 `vue` 导入。
- 页面报 `$store` 未定义：先检查入口是否 `app.use(store)`，再检查模块导出与引入路径。
- `mapState/mapActions` 在 `nvue` 不生效：先检查 `createApp` 返回值是否包含 `Vuex`。
- Pinia 状态更新后页面不刷新：先检查状态字段是否通过 `storeToRefs` 解构。
- Options API 页面无法映射 Pinia：先检查是否使用 `mapState/mapWritableState/mapActions` 且传入 `useXxxStore`。
- 迁移后事件不触发：先把组件事件从 `.native` 改为显式 `emits`，小程序场景优先使用 `tap`。
- 页面参数为空：先检查目标页面是否通过 `props`/`defineProps` 接收参数，而非仅依赖旧式读取路径。
- Promise 错误分支失效：先检查迁移后是否仍按旧格式处理 uni API 返回值。
- TS 编译提示找不到 `uni`：先检查 `tsconfig` 的 `types` 是否包含 `@dcloudio/types`。
- TS 页面导入组件报类型异常：先检查页面与组件的 TS 链路和导入声明是否一致。
- JSX 代码不生效：先检查 `vite.config` 是否注册 `vueJsx()`，再检查 `app-vue3/h5-vue3` 端配置。
- 小程序端 JSX 页面异常：先回退到模板语法实现，避免在不支持端强行共用 JSX 组件。
- 条件编译未生效：先核对平台宏（如 `APP-PLUS/APP-ANDROID/H5/MP-WEIXIN`）再检查条件块位置。
- 样式条件编译失效：先检查是否写成 `// #ifdef`，改为 CSS/HTML 注释语法。
- App 端 `plus is not defined`：先确认是否在 App 端，再把调用放到 `plusready` 回调后执行。
- H5 控制台报 CORS：先确认请求来源域名，再检查服务端 `Access-Control-*`、预检 OPTIONS、网关转发。
- 浏览器插件下可用但线上失败：先移除插件复测，再改为代理或服务端 CORS 白名单方案。
- 宽屏页面元素异常放大：先检查是否全局使用 `rpx`，再核对 `rpxCalcMaxDeviceWidth/rpxCalcBaseDeviceWidth/rpxCalcIncludeWidth`。
- 分栏在 App/小程序不生效：先确认是否依赖 `rightWindow`，改为页面内 `uni-row` + 断点方案。
- iPad 横屏布局错位：先改为运行时响应式（`match-media`/媒体查询）而非新增 PC 条件编译页面。
- SSR 页面首屏正常但交互错乱：先检查 hydration 警告，再比对服务端与客户端首屏数据是否一致。
- SSR 报 `window/document is not defined`：先把浏览器对象访问移到 `onMounted` 或客户端分支。
- SSR 请求未触发：先检查是否把数据加载写在仅客户端执行的钩子中（如只放 `onMounted`）。

## 反例

- 未定位根因直接改代码，导致症状迁移。
- 只在一个端验证就关闭问题单。
- 进入页面立即执行多段同步计算，阻塞首屏渲染。
- 在 `onPageScroll` 中频繁改动布局与样式，导致滑动掉帧。
- 在组件内用 `../static/a.png` 动态拼接路径，迁移页面后大量资源失效。
- Options API 页面只 `import` 不注册组件，运行时出现未定义告警。
- 在 uni-app 项目中把 `node_modules` 放进子目录，导致构建和运行时模块找不到。
- 在样式里写 `@import "/styles/base.css"` 或省略分号，导致编译或加载失败。
- 在 CLI 项目中错误理解 `@` 指向，导入 `json` 时频繁报模块不存在。
- 在模板中直接引用非 `static` 路径，某些端构建后资源丢失。
- 在小程序/App 代码里直接访问 `window/document`，上线后主流程报错。
- 在 `nvue` 页面使用 `vh/vw/rem` 或 web 选择器特性，导致布局与样式异常。
- 列表项使用随机值或索引作为 `key`，导致局部更新后状态错位。
- 子组件直接改 `prop` 或依赖 `.native` 事件做跨端统一处理，导致行为不稳定。
- 页面卸载后未清理定时器或订阅，导致多次进入后逻辑叠加。
- 在 `setup` 中访问 `this` 或滥用 `watchEffect` 重请求，导致运行时异常与性能抖动。
- 按 Vue2 习惯处理 `v-model` 或 `v-bind` 覆盖顺序，导致 Vue3 端行为异常。
- Vue3 组件未声明 `emits` 或滥用多级 props 透传，导致契约不清晰与调试困难。
- 直接解构 `reactive` 字段且未使用 `toRefs`，导致状态更新不生效。
- 在组合式页面里继续用 `onShow/onHide` 监听页面显隐，导致钩子不触发或语义混乱。
- 把页面生命周期 API 从 `vue` 导入，或把响应式 API 从 `@dcloudio/uni-app` 导入，导致运行时/类型异常。
- 在组件中直接改 `store.state` 或在 `mutation` 里写异步请求，导致状态流不可追踪。
- Vuex 模块不开 `namespaced` 却跨模块同名提交，导致状态和调用混乱。
- 直接从 Pinia store 解构状态字段并在模板使用，导致响应性丢失。
- 只在 `setup` 注入 Pinia 但未在入口 `app.use(pinia)`，导致页面拿不到 store。
- Vue3 项目继续混用 `module.exports` 与 `import`，导致运行时模块解析异常。
- 迁移后继续在模板使用过滤器（`{{ val | f }}`），导致编译错误。
- 微信小程序真机白屏但忽略 `optimization.minified` 配置，导致发布后不可用。
- 未安装 `@dcloudio/types` 就直接启用 `lang="ts"`，导致页面 API 类型全面报错。
- TS 代码大量使用 `any` 绕过校验，导致问题延后到运行期暴露。
- 在 uni-app 小程序链路中将 JSX 作为主组件语法，导致编译/运行不兼容。
- 升级 `vite` 后不升级 `@vitejs/plugin-vue-jsx`，导致 JSX 构建失败。
- 在 `template/style` 中继续使用 JS 注释写条件编译，导致块被当普通注释处理。
- 在 `static` 文件内容中写 `#ifdef` 期望按端裁剪，导致资源策略失效。
- 未判断平台直接调用 `plus.os.name`，导致 H5/小程序运行时报错。
- 把 H5 跨域问题归因到小程序/App `uni.request` 限制，导致修复方向偏离。
- 仅在前端改请求头“绕过跨域”，忽略服务端预检与来源校验。
- 把 `750rpx` 长期当成“100% 宽度”，导致宽屏下布局比例异常。
- 依赖 web 窗体（`left/right/topWindow`）实现全端分栏，导致非 web 端失效。
- 为适配平板直接复制 PC 条件编译页面，导致代码分叉和回归成本暴增。
- SSR 页面中直接使用 `Math.random()/new Date()` 参与首屏渲染，导致 hydration 不一致。
- 服务端渲染代码里直接访问浏览器 API，导致首屏渲染失败。
- SSR 发布只更新前端托管资源，不更新 `uni-ssr` 云函数。

## 检查项

- 是否有清晰复现步骤与结论。
- 根因是否被确认并可解释。
- 是否有回归验证结果与风险说明。
- 首屏渲染时长是否可接受，是否存在明显白屏。
- 页面切换与滚动是否有掉帧或卡顿。
- 动态资源路径和跳转路径是否统一为运行时绝对路径。
- 组件引用方式是否与页面写法一致且可命中（easycom 或显式导入注册）。
- `js` 模块路径与第三方依赖位置是否符合规范。
- 样式 `@import` 写法是否符合规范（位置/路径/分号）。
- `json` 路径与字段在目标端是否可用（含条件编译差异）。
- 资源路径是否符合“`static` 直链、非 `static` import 后绑定”规则。
- 是否存在浏览器全局对象误用，及 `vue/nvue` 渲染机制误判问题。
- 是否存在 `vue/nvue` 样式能力混用、及小程序资源路径受限问题。
- 是否存在 Vue 基础指令误用导致的渲染与交互异常。
- 组件通信与插槽语义是否符合单向数据流和作用域规则。
- 生命周期与实例 API 使用是否符合页面阶段与平台能力边界。
- 组合式 API 是否正确处理响应性边界与副作用清理。
- Vue3 语义变更点是否已逐项校验并完成回归。
- Vue3 组件接口（props/emits/expose/slots）是否有清晰边界并可回归验证。
- Vue3 API 时机与响应性处理（`toRefs/nextTick/getCurrentInstance`）是否符合规范。
- 组合式页面显隐监听是否使用 `onPageShow/onPageHide` 而非 `onShow/onHide`。
- Vue3 组合式 API 导入来源是否清晰区分 `vue` 与 `@dcloudio/uni-app`。
- Vuex 注入链路是否完整（`app.use(store)`、`nvue` 返回 `Vuex`）。
- Vuex 是否保持“异步 action、同步 mutation”的约束。
- Pinia 注入链路是否完整（`createPinia`、`app.use(pinia)`、`nvue` 返回 `Pinia`）。
- Pinia 状态消费是否通过 `storeToRefs` 或保持 store 原引用访问。
- Vue3 模块规范与全局注入方式是否完成替换（ESM / `app.config.globalProperties`）。
- 小程序事件体系是否完成迁移（`.native` 下线、`tap`/`data-eventsync` 校验）。
- 迁移后 uni API Promise 语义是否已按 `then/catch` 路径回归验证。
- TypeScript 依赖、`tsconfig`、页面脚本 `lang="ts"` 三者是否配置一致。
- 请求层、状态层是否存在大量 `any` 导致的类型逃逸。
- JSX 配置是否完整（`vueJsx` 插件注册 + 版本匹配）。
- JSX 是否仅用于 `App-vue3/H5-vue3` 支持端。
- 条件编译宏与位置是否正确（`js/vue/nvue/css/pages.json/manifest/uts`）。
- 模板和样式中的条件编译注释语法是否正确。
- App 端 `plus` 能力调用是否已做平台与时机保护。
- H5 跨域链路是否完成服务端 CORS 与预检回归验证。
- 当前请求链路是否明确区分“浏览器受限”与“非浏览器链路”。
- 宽屏场景是否明确“局部拉伸 vs 等比缩放”策略。
- `rpxCalc*` 参数与断点布局是否已在常见宽度档位回归。
- web 专有窗体能力是否被限制在 web 端使用。
- SSR 配置、`uni-ssr` 云函数与静态资源是否保持同版本发布。
- 首屏同构数据是否可复现且不依赖随机/时序差异。
- 浏览器 API 是否已隔离在客户端执行路径。

## 来源

- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-path.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-component.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-script.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-style.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-json.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/page-static-assets.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-js.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-css.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-basics.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-components.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue-composition-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-components.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-composition-api.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-vuex.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/vue3-pinia.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/migration-to-vue3.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/typescript-subject.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/syntax-jsx.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/platform.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/CORS.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/adapt.html
- 官方教程（2026-02-11 查阅）：https://uniapp.dcloud.net.cn/tutorial/ssr.html
